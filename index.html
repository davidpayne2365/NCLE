<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NCLE Contact Lens Exam Trainer</title>
  <style>
    :root {
      --primary-color: #1a5f7a;
      --secondary-color: #57c4e5;
      --accent-color: #d1f1fa;
      --text-color: #333;
      --background-color: #f9feff;
      --neutral-color: #f0f0f0;
      --incorrect-color: #d9534f; /* soft red matching app tone */
    }
    body.dark-mode {
      --primary-color: #57c4e5;
      --secondary-color: #1a5f7a;
      --accent-color: #333;
      --text-color: #f9f9f9;
      --background-color: #1e1e1e;
      --neutral-color: #2e2e2e;
      --incorrect-color: #b5302e; /* darker red for dark mode */
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    html, body { height: 100%; }
    body { background-color: var(--background-color); color: var(--text-color); line-height: 1.6; padding: 10px; display: flex; flex-direction: column; transition: background-color .3s, color .3s; }
    h1 { font-size: 1.5rem; margin-bottom: 10px; color: var(--primary-color); text-align: center; }

    .dark-toggle { position: absolute; top: 10px; right: 10px; background: var(--primary-color); color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; transition: background .3s; }
    .dark-toggle:hover { background: var(--secondary-color); }

    .quiz-container { background: var(--neutral-color); border-radius: 8px; padding: 16px; margin: 40px auto 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); flex: 1; max-width: 500px; display: flex; flex-direction: column; }
    .question-container, .explanation-container { flex: 1; display: flex; flex-direction: column; justify-content: flex-start; }
    .question-container { padding: 12px; background: var(--accent-color); border-radius: 8px; }
    .question { font-weight: bold; margin-bottom: 12px; }
    .options { list-style: none; padding: 0; flex: 1; overflow: auto; }
    .option { background: var(--background-color); border: 1px solid #ddd; border-radius: 4px; padding: 12px; margin-bottom: 8px; cursor: pointer; transition: background-color .3s; color: var(--text-color);}    
    .option:hover { background: #ccc; }
    .option.correct { background: var(--primary-color); color: white; }
    .option.incorrect { background: var(--incorrect-color); color: white; }

    .explanation-container { display: none; padding: 12px; background: var(--neutral-color); border-radius: 8px; }
    .explanation-container.wrong { background: var(--incorrect-color); color: white; }
    .explanation-container h3 { margin: 8px 0; color: var(--primary-color); }
    .explanation-container .correct-answer { font-weight: bold; margin-bottom: 12px; }

    .buttons { display: flex; justify-content: space-between; margin-top: 12px; }
    button { padding: 12px; border: none; border-radius: 4px; background: var(--primary-color); color: white; font-size: 1rem; cursor: pointer; transition: background-color .3s; flex: 1; margin: 0 4px; }
    button:hover { background: var(--secondary-color); }
    button:disabled { background: #cccccc; cursor: not-allowed; }

    #results-screen { display: none; text-align: center; margin-top: 20px; }
    #results-screen h2 { margin-bottom: 10px; }

    @media (max-width: 600px) {
      .quiz-container { margin: 5px; padding: 12px; }
      h1 { font-size: 1.8rem; }
      .option, button, .dark-toggle { font-size: 1.1rem; padding: 14px; }
    }
  </style>
</head>
<body>
  <button class="dark-toggle" id="dark-toggle">Toggle Dark Mode</button>
  <h1>If you get to the "Success" screen you will pass your exam!</h1>
  <main style="flex:1; display:flex; flex-direction:column; position: relative;">
    <div class="quiz-container" id="quiz-container">
      <div class="question-container" id="question-container">
        <p class="question" id="question-text"></p>
        <ul class="options" id="options-list"></ul>
      </div>
      <div class="explanation-container" id="explanation-container">
        <div class="correct-answer" id="correct-answer"></div>
        <h3>Explanation:</h3>
        <p id="explanation-text"></p>
      </div>
      <div class="buttons">
        <button id="prev-btn" disabled style="display:none;">Previous</button>
        <button id="next-btn" disabled>Next</button>
      </div>
      <div id="results-screen">
        <h2>Quiz Complete</h2>
        <p>You've completed all questions correctly!</p>
        <button id="restart-btn">Restart Quiz</button>
      </div>
    </div>
  </main>

  <script src="quiz-questions.js"></script>
  <script>
    // Dark mode toggle
    const darkToggle = document.getElementById('dark-toggle');
    const body = document.body;
    function applyDarkMode(mode) {
      if (mode) body.classList.add('dark-mode');
      else body.classList.remove('dark-mode');
      localStorage.setItem('darkMode', mode);
    }
    darkToggle.addEventListener('click', () => {
      const isDark = body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', isDark);
    });
    // Load dark mode setting
    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('darkMode') === 'true';
      applyDarkMode(saved);
    });

    let remainingIndexes = [];
    let wrongIndexes = [];
    let currentQuestionIdx = null;
    let isFailed = false;

    const questionContainer = document.getElementById('question-container');
    const explanationContainer = document.getElementById('explanation-container');
    const nextBtn = document.getElementById('next-btn');
    const restartBtn = document.getElementById('restart-btn');
    const questionText = document.getElementById('question-text');
    const optionsList = document.getElementById('options-list');
    const explanationText = document.getElementById('explanation-text');
    const correctAnswerDiv = document.getElementById('correct-answer');
    const resultsScreen = document.getElementById('results-screen');

    nextBtn.addEventListener('click', loadQuestion);
    restartBtn.addEventListener('click', () => {
      localStorage.removeItem('remainingIndexes');
      localStorage.removeItem('wrongIndexes');
      remainingIndexes = quizQuestions.map((_, i) => i);
      wrongIndexes = [];
      resultsScreen.style.display = 'none';
      startQuiz();
    });

    function loadState() {
      const rem = localStorage.getItem('remainingIndexes');
      const wrong = localStorage.getItem('wrongIndexes');
      if (rem && wrong) {
        remainingIndexes = JSON.parse(rem);
        wrongIndexes = JSON.parse(wrong);
      } else {
        remainingIndexes = quizQuestions.map((_, i) => i);
        wrongIndexes = [];
        localStorage.setItem('remainingIndexes', JSON.stringify(remainingIndexes));
        localStorage.setItem('wrongIndexes', JSON.stringify(wrongIndexes));
      }
    }

    function startQuiz() {
      loadState();
      resultsScreen.style.display = 'none';
      questionContainer.style.display = 'flex';
      explanationContainer.style.display = 'none';
      loadQuestion();
    }

    function loadQuestion() {
      explanationContainer.classList.remove('wrong');
      explanationContainer.style.display = 'none';
      questionContainer.style.display = 'flex';
      nextBtn.disabled = true;
      optionsList.innerHTML = '';

      if (remainingIndexes.length === 0) {
        if (wrongIndexes.length > 0) {
          remainingIndexes = wrongIndexes.slice();
          wrongIndexes = [];
          localStorage.setItem('remainingIndexes', JSON.stringify(remainingIndexes));
          localStorage.setItem('wrongIndexes', JSON.stringify(wrongIndexes));
        } else {
          questionContainer.style.display = 'none';
          explanationContainer.style.display = 'none';
          resultsScreen.style.display = 'block';
          return;
        }
      }

      currentQuestionIdx = remainingIndexes.shift();
      localStorage.setItem('remainingIndexes', JSON.stringify(remainingIndexes));
      const q = quizQuestions[currentQuestionIdx];
      questionText.textContent = q.question;
      q.options.forEach((opt, i) => {
        const li = document.createElement('li');
        li.className = 'option';
        li.textContent = opt;
        li.dataset.index = i;
        li.addEventListener('click', handleOptionClick);
        optionsList.appendChild(li);
      });
    }

    function handleOptionClick(e) {
      const selected = +e.target.dataset.index;
      const q = quizQuestions[currentQuestionIdx];
      const correctIndex = q.answer;
      isFailed = selected !== correctIndex;

      document.querySelectorAll('.option').forEach((optEl, idx) => {
        optEl.removeEventListener('click', handleOptionClick);
        if (idx === correctIndex) optEl.classList.add('correct');
        else if (idx === selected) optEl.classList.add('incorrect');
      });

      correctAnswerDiv.textContent = 'Correct Answer: ' + q.options[correctIndex];
      explanationText.textContent = q.explanation;

      if (isFailed) {
        wrongIndexes.push(currentQuestionIdx);
        explanationContainer.classList.add('wrong');
        localStorage.setItem('wrongIndexes', JSON.stringify(wrongIndexes));
      }

      questionContainer.style.display = 'none';
      explanationContainer.style.display = 'flex';
      nextBtn.disabled = false;
    }

    document.addEventListener('DOMContentLoaded', startQuiz);
  </script>
</body>
</html>
