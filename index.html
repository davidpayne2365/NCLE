<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NCLE 30â€‘Day Cram Trainer</title>
  <style>
    :root {
      --primary: #57c4e5;
      --secondary: #1a5f7a;
      --accent: #333;
      --text-light: #f9f9f9;
      --bg-dark: #1e1e1e;
      --neutral: #2e2e2e;
      --incorrect: #b5302e;
      --mastered: #4caf50;
    }

    *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
    html,body{height:100%}
    body{background:var(--bg-dark);color:var(--text-light);display:flex;flex-direction:column;line-height:1.6;padding:10px}

    h1{text-align:center;color:var(--primary);margin-bottom:12px;font-size:1.6rem}
    .progress-wrapper{display:flex;justify-content:center;margin-bottom:8px}
    svg.progress-ring{width:72px;height:72px;transform:rotate(-90deg)}

    .quiz-container{flex:1;max-width:540px;margin:0 auto;display:flex;flex-direction:column;background:var(--neutral);border-radius:8px;padding:16px;gap:12px}
    .question-box,.explanation-box{background:var(--accent);padding:14px;border-radius:8px;display:none;flex-direction:column;gap:12px;flex:1;overflow-y:auto}
    .question-box.active,.explanation-box.active{display:flex}

    ul.options{list-style:none;display:flex;flex-direction:column;gap:8px}
    li.option{padding:12px;background:var(--bg-dark);border:1px solid #444;border-radius:4px;cursor:pointer;transition:background-color .25s}
    li.option:hover{background:#3a3a3a}
    li.option.correct{background:var(--primary);color:#fff}
    li.option.incorrect{background:var(--incorrect);color:#fff}

    .explanation-box.wrong{background:var(--incorrect)}

    .confidence-buttons{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
    button.conf{flex:1 1 30%;padding:10px;border:none;border-radius:4px;font-size:1rem;cursor:pointer}
    button.repeat{background:var(--incorrect);color:#fff}
    button.got{background:var(--primary);color:#fff}
    button.easy{background:var(--mastered);color:#fff}
    button.conf:hover{opacity:.85}

    .results{text-align:center;display:none}
    @media(max-width:600px){h1{font-size:1.4rem}}
  </style>
</head>
<body>
  <h1>NCLE 30â€‘Day Cram Trainer</h1>
  <div class="progress-wrapper">
    <svg class="progress-ring" viewBox="0 0 120 120">
      <circle cx="60" cy="60" r="54" stroke="#444" stroke-width="12" fill="none"></circle>
      <circle id="progress-ring-fill" cx="60" cy="60" r="54" stroke="var(--primary)" stroke-width="12" stroke-linecap="round" fill="none" stroke-dasharray="339.292" stroke-dashoffset="339.292"></circle>
    </svg>
  </div>

  <main class="quiz-container" id="quiz">
    <section class="question-box active" id="qBox">
      <p id="qText" class="question"></p>
      <ul id="options" class="options"></ul>
    </section>

    <section class="explanation-box" id="expBox">
      <p id="correctAns"></p>
      <h3>Explanation</h3>
      <p id="expText"></p>
      <div class="confidence-buttons">
        <button class="conf repeat" data-quality="2">RepeatÂ Now</button>
        <button class="conf got"    data-quality="4">GotÂ It</button>
        <button class="conf easy"   data-quality="5">TooÂ Easy</button>
      </div>
    </section>

    <section class="results" id="results">
      <h2>Session Complete ðŸŽ¯</h2>
      <p>Youâ€˜ve reached todayâ€™s goal. Come back tomorrow for the next batch.</p>
      <button id="restart">RestartÂ Today</button>
    </section>
  </main>

  <script src="quiz-questions.js"></script>
  <script>
  (()=>{
    /*â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“  CONFIG  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“*/
    const MS_HOUR = 3.6e6;
    const NEW_LIMIT = 25;                 // new cards per day
    const KEY = 'ncle_spaced_data_v3';    // bump version for logic fix

    /*â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“  INIT OR LOAD SPACED DATA  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“*/
    if(!localStorage.getItem(KEY)){
      const init = quizQuestions.map(()=>({interval:0,ease:2.5,repetitions:0,due:0,lastSeen:0}));
      localStorage.setItem(KEY,JSON.stringify(init));
    }
    const spacedData = JSON.parse(localStorage.getItem(KEY));
    const save = ()=>localStorage.setItem(KEY,JSON.stringify(spacedData));

    /*â€“â€“â€“â€“â€“â€“â€“â€“ DAILY NEWâ€‘CARD COUNTER & DATE ROLL â€“â€“â€“â€“â€“â€“â€“â€“*/
    const todayKey = ()=>new Date().toISOString().slice(0,10);
    if(localStorage.getItem('newCountDate')!==todayKey()){
      localStorage.setItem('newCountDate',todayKey());
      localStorage.setItem('newCount','0');
    }
    const newCount = ()=>+localStorage.getItem('newCount');
    const incNew = ()=>localStorage.setItem('newCount',String(newCount()+1));

    /*â€“â€“â€“â€“â€“â€“â€“â€“â€“  SMâ€‘2 WITH ACCELERATED INTERVALS  â€“â€“â€“â€“â€“â€“â€“â€“*/
    function sm2(card,q){
      if(q<3){
        card.repetitions = 0;
        card.interval   = 0;               // show again immediately
      } else {
        card.repetitions += 1;
        if(card.repetitions===1)      card.interval = 12*MS_HOUR;      // 12h
        else if(card.repetitions===2) card.interval = 36*MS_HOUR;      // 1.5d
        else                           card.interval = Math.round(card.interval * card.ease);
      }
      card.ease = Math.max(1.3, card.ease + (0.1 - (5-q)*(0.08 + (5-q)*0.02)));
      card.due  = Date.now() + card.interval;
      card.lastSeen = Date.now();
      save();
    }

    /*â€“â€“â€“â€“â€“â€“â€“â€“â€“  DOM REFERENCES  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“*/
    const qBox = document.getElementById('qBox');
    const expBox = document.getElementById('expBox');
    const qText = document.getElementById('qText');
    const optionsEl = document.getElementById('options');
    const correctAns = document.getElementById('correctAns');
    const expText = document.getElementById('expText');
    const results = document.getElementById('results');
    const ring = document.getElementById('progress-ring-fill');
    const restartBtn = document.getElementById('restart');

    const RING = 339.292;

    /*â€“â€“â€“â€“â€“ SESSION SCOPE: initial due list & goal â€“â€“â€“â€“â€“*/
    const initialDue = () => spacedData.filter(c=>c.due<=Date.now() && c.lastSeen>0).length;
    let sessionGoal = NEW_LIMIT + initialDue();

    /*â€“â€“â€“â€“â€“â€“â€“â€“   SELECTION HELPERS   â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“*/
    const dueIdx = ()=>spacedData.map((c,i)=>c.due<=Date.now()&&c.lastSeen>0?i:null).filter(i=>i!==null);
    const unseenIdx = ()=>spacedData.map((c,i)=>c.lastSeen===0?i:null).filter(i=>i!==null);

    function nextCard(){
      const due = dueIdx();
      if(due.length) return due[Math.floor(Math.random()*due.length)];
      if(newCount()<NEW_LIMIT){
        const unseen = unseenIdx();
        if(unseen.length) return unseen[Math.floor(Math.random()*unseen.length)];
      }
      return null;
    }

    /*â€“â€“â€“â€“â€“â€“â€“â€“ PROGRESS RING â€“â€“â€“â€“â€“â€“â€“â€“â€“*/
    function updateRing(){
      const todayDone = spacedData.filter(c=>c.lastSeen>0 && new Date(c.lastSeen).toISOString().slice(0,10)===todayKey()).length;
      const pct = Math.min(1, todayDone / sessionGoal);
      ring.style.strokeDashoffset = RING * (1-pct);
      ring.style.stroke = pct===1 ? 'var(--mastered)' : 'var(--primary)';
    }

    /*â€“â€“â€“â€“â€“â€“â€“â€“ PRESENT QUESTION â€“â€“â€“â€“â€“â€“â€“*/
    let current = null;
    function present(idx){
      current = idx;
      const q = quizQuestions[idx];
      qText.textContent = q.question;
      optionsEl.innerHTML='';
      q.options.forEach((o,i)=>{
        const li=document.createElement('li');
        li.className='option';
        li.textContent=o;
        li.dataset.i=i;
        li.onclick=selectOption;
        optionsEl.appendChild(li);
      });
      qBox.classList.add('active');
      expBox.classList.remove('active','wrong');
      results.style.display='none';
    }

    function selectOption(e){
      const sel=+e.currentTarget.dataset.i;
      const q=quizQuestions[current];
      const ans=q.answer;
      document.querySelectorAll('li.option').forEach((li,i)=>{
        if(i===ans) li.classList.add('correct');
        if(i===sel&&i!==ans) li.classList.add('incorrect');
        li.onclick=null;
      });
      correctAns.textContent=`Correct Answer: ${q.options[ans]}`;
      expText.textContent=q.explanation;
      if(sel!==ans) expBox.classList.add('wrong');
      qBox.classList.remove('active');
      expBox.classList.add('active');
    }

    /*â€“â€“â€“â€“â€“â€“â€“â€“ BUTTON HANDLERS â€“â€“â€“â€“â€“â€“â€“*/
    document.querySelectorAll('button.conf').forEach(btn=>btn.onclick=()=>{
      if(spacedData[current].lastSeen===0) incNew();
      sm2(spacedData[current],+btn.dataset.quality);
      proceed();
    });
    restartBtn.onclick=()=>{localStorage.setItem('newCount','0'); sessionGoal = NEW_LIMIT + dueIdx().length; proceed();};

    function proceed(){
      updateRing();
      const idx=nextCard();
      if(idx===null){
        qBox.classList.remove('active');
        expBox.classList.remove('active');
        results.style.display='block';
        return;
      }
      present(idx);
    }

    /*â€“â€“â€“â€“â€“â€“â€“â€“  BOOTSTRAP  â€“â€“â€“â€“â€“â€“â€“â€“â€“*/
    sessionGoal = NEW_LIMIT + dueIdx().length;  // recalc after load
    updateRing();
    const first=nextCard();
    if(first!==null) present(first); else results.style.display='block';
  })();
  </script>
</body>
</html>
